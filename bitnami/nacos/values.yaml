## @section Global parameters
## Global Docker image parameters
## Please, note that this will override the image parameters, including dependencies, configured to use the global value

global:
  ## @param global.imageRegistry Global Docker image registry
  imageRegistry: ""
  ## @param global.imagePullSecrets Global Docker registry secret names as an array
  imagePullSecrets: []
  ## @param global.storageClass Global StorageClass for Persistent Volume(s)
  storageClass: ""

## @section Common parameters

## @param nameOverride String to partially override nacos.fullname
nameOverride: ""
## @param fullnameOverride String to fully override nacos.fullname
fullnameOverride: ""
## @param namespaceOverride String to fully override common.names.namespace
namespaceOverride: ""
## @param commonLabels Labels to add to all deployed objects
commonLabels: {}
## @param commonAnnotations Annotations to add to all deployed objects
commonAnnotations: {}
## @param clusterDomain Kubernetes cluster domain name
clusterDomain: cluster.local

## @section Nacos Image parameters

image:
  ## @param image.registry Nacos image registry
  registry: docker.io
  ## @param image.repository Nacos image repository
  repository: nacos/nacos-server
  ## @param image.tag Nacos image tag (immutable tags are recommended)
  tag: v3.1.1
  ## @param image.pullPolicy Nacos image pull policy
  pullPolicy: IfNotPresent
  ## @param image.pullSecrets Nacos image pull secrets
  pullSecrets: []

## @section Nacos Configuration parameters

## @param mode Nacos server mode: standalone or cluster
mode: cluster

## @param replicaCount Number of Nacos replicas (should be odd number for cluster mode: 3, 5, 7)
replicaCount: 3

## @section Nacos Authentication parameters
## ref: https://nacos.io/docs/latest/guide/user/auth/

auth:
  ## @param auth.enabled Enable Nacos authentication
  enabled: true
  ## @param auth.token JWT token for authentication (base64, min 32 bytes). Auto-generated if empty
  token: ""
  ## @param auth.identity.key Identity key for node-to-node authentication
  ## @param auth.identity.value Identity value for node-to-node authentication
  identity:
    key: ""
    value: ""
  ## @param auth.existingSecret Name of existing secret containing auth credentials
  ## Secret must contain keys: NACOS_AUTH_TOKEN, NACOS_AUTH_IDENTITY_KEY, NACOS_AUTH_IDENTITY_VALUE
  existingSecret: ""

## @section Database Configuration
## Nacos supports MySQL, PostgreSQL, and embedded Derby (standalone only)

database:
  ## @param database.type Database type: mysql, postgresql, or embedded
  ## embedded is only supported in standalone mode
  type: mysql
  
  ## @param database.host Database host
  host: ""
  ## @param database.port Database port (default: 3306 for mysql, 5432 for postgresql)
  port: ""
  ## @param database.name Database name
  name: nacos
  ## @param database.username Database username
  username: nacos
  ## @param database.password Database password (ignored if existingSecret is set)
  password: ""
  ## @param database.existingSecret Name of existing secret containing database password
  ## Secret must contain key: database-password
  existingSecret: ""
  
  ## @param database.mysql.param MySQL JDBC connection parameters
  mysql:
    param: "characterEncoding=utf8&connectTimeout=10000&socketTimeout=30000&autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai"
  
  ## @param database.postgresql.param PostgreSQL JDBC connection parameters
  postgresql:
    param: "tcpKeepAlive=true&reWriteBatchedInserts=true&ApplicationName=nacos_java&sslmode=disable&prepareThreshold=0"
    ## @param database.postgresql.pool PostgreSQL connection pool settings
    pool:
      connectionTimeout: 30000
      validationTimeout: 10000
      maximumPoolSize: 20
      minimumIdle: 2

  ## Database initialization settings
  init:
    ## @param database.init.enabled Enable database schema initialization
    enabled: true
    ## @param database.init.image.mysql.registry MySQL init container image registry
    ## @param database.init.image.mysql.repository MySQL init container image repository
    ## @param database.init.image.mysql.tag MySQL init container image tag
    ## @param database.init.image.postgresql.registry PostgreSQL init container image registry
    ## @param database.init.image.postgresql.repository PostgreSQL init container image repository
    ## @param database.init.image.postgresql.tag PostgreSQL init container image tag
    ## @param database.init.image.pullPolicy Init container image pull policy
    image:
      mysql:
        registry: docker.io
        repository: mysql
        tag: "8.0"
      postgresql:
        registry: docker.io
        repository: postgres
        tag: "16-alpine"
      pullPolicy: IfNotPresent
    ## @param database.init.resources Init container resource requests and limits
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

## @section Extra Configuration
## Additional Nacos configuration properties
## These will be added to /home/nacos/init.d/custom.properties

## @param extraConfig Additional configuration properties (key=value format)
## Example:
##   extraConfig: |
##     nacos.naming.empty-service.auto-clean=true
##     server.tomcat.accesslog.enabled=false
##     nacos.core.auth.caching.enabled=true
extraConfig: ""

## @section JVM parameters
## Nacos JVM configuration
## ref: https://github.com/nacos-group/nacos-docker

jvm:
  ## @param jvm.xms JVM initial heap size
  xms: "1g"
  ## @param jvm.xmx JVM maximum heap size
  xmx: "1g"
  ## @param jvm.xmn JVM young generation size
  xmn: "512m"
  ## @param jvm.metaspaceSize JVM Metaspace initial size
  metaspaceSize: "128m"
  ## @param jvm.maxMetaspaceSize JVM Metaspace maximum size
  maxMetaspaceSize: "320m"
  ## @param jvm.maxDirectMemorySize JVM max direct memory size (optional)
  maxDirectMemorySize: ""
  ## @param jvm.extraOpts Additional JVM options
  extraOpts: ""

## @section Nacos Peer Finder Plugin (for cluster mode)

plugin:
  ## @param plugin.enabled Enable peer finder plugin (required for cluster mode)
  enabled: true
  ## @param plugin.image.registry Plugin image registry
  ## @param plugin.image.repository Plugin image repository
  ## @param plugin.image.tag Plugin image tag
  ## @param plugin.image.pullPolicy Plugin image pull policy
  image:
    registry: docker.io
    repository: nacos/nacos-peer-finder-plugin
    tag: "1.1"
    pullPolicy: IfNotPresent

## @section Service parameters

service:
  ## @param service.type Kubernetes Service type
  type: ClusterIP
  ## @param service.labels Additional labels for Nacos service
  labels: {}
  ## @param service.ports.http Nacos console HTTP port
  ## @param service.ports.client Nacos client port (main API port)
  ## @param service.ports.clientRpc Nacos client gRPC port
  ## @param service.ports.raftRpc Nacos raft gRPC port
  ## @param service.ports.mcp Nacos MCP (Microservice Config Protocol) port
  ports:
    http: 8080
    client: 8848
    clientRpc: 9848
    raftRpc: 9849
    mcp: 9080
  ## @param service.nodePorts.http Node port for HTTP (when service.type is NodePort)
  ## @param service.nodePorts.client Node port for client (when service.type is NodePort)
  nodePorts:
    http: ""
    client: ""
  ## @param service.clusterIP Nacos service Cluster IP
  clusterIP: ""
  ## @param service.loadBalancerIP Nacos service Load Balancer IP
  loadBalancerIP: ""
  ## @param service.loadBalancerSourceRanges Nacos service Load Balancer sources
  loadBalancerSourceRanges: []
  ## @param service.externalTrafficPolicy Nacos service external traffic policy (only for LoadBalancer/NodePort)
  externalTrafficPolicy: ""
  ## @param service.annotations Additional custom annotations for Nacos service
  annotations: {}
  ## @param service.sessionAffinity Session Affinity for Kubernetes service
  sessionAffinity: None

## @section Ingress parameters

ingress:
  ## @param ingress.enabled Enable ingress record generation for Nacos
  enabled: false
  ## @param ingress.ingressClassName IngressClass that will be used
  ingressClassName: ""
  ## @param ingress.hostname Default host for the ingress record
  hostname: nacos.local
  ## @param ingress.path Default path for the ingress record
  path: /
  ## @param ingress.pathType Ingress path type
  pathType: Prefix
  ## @param ingress.annotations Additional annotations for the Ingress resource
  annotations: {}
  ## @param ingress.tls Enable TLS configuration for the host defined at ingress.hostname
  tls: false
  ## @param ingress.tlsSecretName TLS secret name (auto-generated if not specified)
  tlsSecretName: ""
  ## @param ingress.extraHosts An array with additional hostname(s) to be covered with the ingress record
  extraHosts: []
  ## @param ingress.extraTls TLS configuration for additional hostname(s)
  extraTls: []

## @section Persistence parameters
## IMPORTANT: Persistence is RECOMMENDED for all deployment modes.
## Even with external database, Nacos generates significant local data:
## - /home/nacos/logs: access_log (can grow several GB per day), application logs
## - /home/nacos/data/protocol/raft/*/log: Raft logs (RocksDB, can grow very large)
## Without PVC, these will consume node disk space and may crash the host.

persistence:
  ## @param persistence.enabled Enable persistence using Persistent Volume Claims
  ## Strongly recommended for production to avoid filling up node disk
  enabled: true
  ## @param persistence.storageClass Storage class of backing PVC
  storageClass: ""
  ## @param persistence.accessModes Persistent Volume access modes
  accessModes:
    - ReadWriteOnce
  ## @param persistence.size Size of data volume (10Gi minimum recommended for production)
  size: 10Gi
  ## @param persistence.annotations Additional custom annotations for the PVC
  annotations: {}
  ## @param persistence.selector Selector to match an existing Persistent Volume
  selector: {}
  ## @param persistence.existingClaim Name of an existing PVC to use
  existingClaim: ""

## @section Pod Security Context

podSecurityContext:
  ## @param podSecurityContext.enabled Enable security context for Nacos pods
  enabled: true
  ## @param podSecurityContext.fsGroup Set Nacos pod's Security Context fsGroup
  fsGroup: 1000

## @section Container Security Context

containerSecurityContext:
  ## @param containerSecurityContext.enabled Enable container security context
  enabled: true
  ## @param containerSecurityContext.runAsUser Set container's Security Context runAsUser
  runAsUser: 1000
  ## @param containerSecurityContext.runAsNonRoot Set container's Security Context runAsNonRoot
  runAsNonRoot: true
  ## @param containerSecurityContext.allowPrivilegeEscalation Set container's Security Context allowPrivilegeEscalation
  allowPrivilegeEscalation: false
  ## @param containerSecurityContext.readOnlyRootFilesystem Set container's Security Context readOnlyRootFilesystem
  readOnlyRootFilesystem: false
  ## @param containerSecurityContext.capabilities.drop Set container's Security Context capabilities to drop
  capabilities:
    drop:
      - ALL

## @section Resource parameters

resources:
  ## @param resources.limits The resources limits for the Nacos containers
  ## @param resources.requests The requested resources for the Nacos containers
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 1Gi

## @section Probe parameters

startupProbe:
  ## @param startupProbe.enabled Enable startup probe
  enabled: true
  ## @param startupProbe.initialDelaySeconds Initial delay seconds for startup probe
  initialDelaySeconds: 30
  ## @param startupProbe.periodSeconds Period seconds for startup probe
  periodSeconds: 10
  ## @param startupProbe.timeoutSeconds Timeout seconds for startup probe
  timeoutSeconds: 5
  ## @param startupProbe.failureThreshold Failure threshold for startup probe
  failureThreshold: 30
  ## @param startupProbe.successThreshold Success threshold for startup probe
  successThreshold: 1

livenessProbe:
  ## @param livenessProbe.enabled Enable liveness probe
  enabled: true
  ## @param livenessProbe.initialDelaySeconds Initial delay seconds for liveness probe
  initialDelaySeconds: 10
  ## @param livenessProbe.periodSeconds Period seconds for liveness probe
  periodSeconds: 10
  ## @param livenessProbe.timeoutSeconds Timeout seconds for liveness probe
  timeoutSeconds: 5
  ## @param livenessProbe.failureThreshold Failure threshold for liveness probe
  failureThreshold: 3
  ## @param livenessProbe.successThreshold Success threshold for liveness probe
  successThreshold: 1

readinessProbe:
  ## @param readinessProbe.enabled Enable readiness probe
  enabled: true
  ## @param readinessProbe.initialDelaySeconds Initial delay seconds for readiness probe
  initialDelaySeconds: 10
  ## @param readinessProbe.periodSeconds Period seconds for readiness probe
  periodSeconds: 10
  ## @param readinessProbe.timeoutSeconds Timeout seconds for readiness probe
  timeoutSeconds: 5
  ## @param readinessProbe.failureThreshold Failure threshold for readiness probe
  failureThreshold: 3
  ## @param readinessProbe.successThreshold Success threshold for readiness probe
  successThreshold: 1

## @section Pod Disruption Budget parameters

podDisruptionBudget:
  ## @param podDisruptionBudget.enabled Enable PodDisruptionBudget
  enabled: true
  ## @param podDisruptionBudget.minAvailable Minimum number of pods that must be available
  minAvailable: ""
  ## @param podDisruptionBudget.maxUnavailable Maximum number of pods that can be unavailable
  maxUnavailable: 1

## @section Autoscaling parameters
## HPA is supported when using:
##   - External database (MySQL/PostgreSQL)
##   - Ephemeral instances (default, spring.cloud.nacos.discovery.ephemeral=true)
## In this mode, Nacos is essentially stateless - data is in DB, services use Distro protocol
## Do NOT use HPA with embedded database or persistent instances (they use Raft)

autoscaling:
  ## @param autoscaling.enabled Enable Horizontal Pod Autoscaler
  enabled: false
  ## @param autoscaling.minReplicas Minimum number of replicas
  minReplicas: 3
  ## @param autoscaling.maxReplicas Maximum number of replicas
  maxReplicas: 7
  ## @param autoscaling.targetCPUUtilizationPercentage Target CPU utilization percentage
  targetCPUUtilizationPercentage: 70
  ## @param autoscaling.targetMemoryUtilizationPercentage Target Memory utilization percentage
  targetMemoryUtilizationPercentage: ""
  ## @param autoscaling.behavior HPA behavior configuration for scale up/down
  behavior:
    scaleDown:
      ## Slow scale down to avoid disruption
      stabilizationWindowSeconds: 300
      policies:
        - type: Pods
          value: 1
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Pods
          value: 2
          periodSeconds: 60

## @section Scheduling parameters

## @param nodeSelector Node labels for pod assignment
nodeSelector: {}

## @param tolerations Tolerations for pod assignment
tolerations: []

## @param affinity Affinity for pod assignment
affinity: {}

## @param podAntiAffinityPreset Pod anti-affinity preset: soft or hard
podAntiAffinityPreset: hard

## @param topologySpreadConstraints Topology Spread Constraints for pod assignment
topologySpreadConstraints: []

## @param priorityClassName Priority class name for Nacos pods
priorityClassName: ""

## @section ServiceAccount parameters

serviceAccount:
  ## @param serviceAccount.create Enable creation of ServiceAccount
  create: true
  ## @param serviceAccount.name Name of the service account to use
  name: ""
  ## @param serviceAccount.annotations Annotations for service account
  annotations: {}
  ## @param serviceAccount.automountServiceAccountToken Automount service account token
  automountServiceAccountToken: false

## @section RBAC parameters

rbac:
  ## @param rbac.create Create RBAC resources
  create: false

## @section Extra configuration

## @param extraEnvVars Array of extra environment variables
extraEnvVars: []
## @param extraEnvVarsCM Name of ConfigMap containing extra environment variables
extraEnvVarsCM: ""
## @param extraEnvVarsSecret Name of Secret containing extra environment variables
extraEnvVarsSecret: ""

## @param extraVolumes Array of extra volumes
extraVolumes: []
## @param extraVolumeMounts Array of extra volume mounts
extraVolumeMounts: []

## @param initContainers Add additional init containers
initContainers: []
## @param sidecars Add additional sidecar containers
sidecars: []

## @section Metrics parameters
## Nacos supports metrics export to Prometheus, Elasticsearch and InfluxDB
## ref: https://nacos.io/docs/latest/guide/admin/monitor-guide/

metrics:
  ## @param metrics.enabled Enable metrics endpoint exposure (/nacos/actuator/prometheus)
  enabled: false
  
  ## Elasticsearch metrics export (Spring Boot Actuator)
  elasticsearch:
    ## @param metrics.elasticsearch.enabled Enable Elasticsearch metrics export
    enabled: false
    ## @param metrics.elasticsearch.host Elasticsearch host URL
    host: "http://localhost:9200"
  
  ## InfluxDB metrics export (Spring Boot Actuator)
  influxdb:
    ## @param metrics.influxdb.enabled Enable InfluxDB metrics export
    enabled: false
    ## @param metrics.influxdb.uri InfluxDB URI
    uri: "http://localhost:8086"
    ## @param metrics.influxdb.db InfluxDB database name
    db: "nacos"
    ## @param metrics.influxdb.autoCreateDb Auto create database
    autoCreateDb: true
    ## @param metrics.influxdb.consistency Write consistency (one, quorum, all, any)
    consistency: "one"
    ## @param metrics.influxdb.compressed Enable compression
    compressed: true
  
  ## Prometheus Operator ServiceMonitor
  serviceMonitor:
    ## @param metrics.serviceMonitor.enabled Create ServiceMonitor resource (requires Prometheus Operator)
    enabled: false
    ## @param metrics.serviceMonitor.namespace Namespace for the ServiceMonitor
    namespace: ""
    ## @param metrics.serviceMonitor.interval Scrape interval
    interval: 30s
    ## @param metrics.serviceMonitor.scrapeTimeout Scrape timeout
    scrapeTimeout: 10s
    ## @param metrics.serviceMonitor.path Metrics path
    path: /nacos/actuator/prometheus
    ## @param metrics.serviceMonitor.labels Additional labels for ServiceMonitor
    labels: {}
    ## @param metrics.serviceMonitor.annotations Additional annotations for ServiceMonitor
    annotations: {}

## @section Network Policy parameters

networkPolicy:
  ## @param networkPolicy.enabled Enable NetworkPolicy
  enabled: false
  ## @param networkPolicy.allowExternal Allow external connections
  allowExternal: true
  ## @param networkPolicy.extraIngress Additional ingress rules
  extraIngress: []
  ## @param networkPolicy.extraEgress Additional egress rules
  extraEgress: []
